<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokedex</title>
    <link rel="shortcut icon" href="./imagenes/pokemon.png" type="image/x-icon">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;400&family=VT323&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="styles.css">

</head>
<!--Cuerpo de nuestro programa-->
<body id="pokecuerpo" class="place-items-center">
    <a href="index.html" id="menuBoton" class="rounded-lg p-2 m-2 cursor-pointer">Menu</a>
    <div id="cabeza" class="flex m-2 gap-1">
        <div class="p-4">
            <button id="boton_iz" class="rounded-lg p-2 m-2 cursor-pointer"><</button>
        </div>
        <h1 id="title" class="">POKEDEX</h1>
        <div class="p-4">
            <button id="boton_der" class="rounded-lg p-2 m-2 cursor-pointer">></button>
        </div>
    </div>

    <div id="menu_seleccion" class="p-4 mt-8 mb-8 rounded-lg">

        <div id="menu_tarjetas" class="grid grid-cols-4 grid-rows-3 gap-9">
            
        </div>
    </div>
    <script type="text/javascript">
        //variables para pagina? 
        let currentPage = 1;
        //evito que se refresque
        $(function(){
            $("#boton_iz").submit(function(e){
                e.preventDefault();
            })
            $("#boton_der").submit(function(e){
                e.preventDefault();
            })
        })
        //funcion de cada boton 
        $("#boton_iz").click(function(){
            if (currentPage>1){
                cargarPokemones(currentPage-1);
            }
        })
        $("#boton_der").click(function(){
            cargarPokemones(currentPage+1);
        })

        //llamamos a todos los pokemones
        function cargarPokemones(page=1){
            
            $.ajax({
            url:"http://localhost:8080/pokemones/pokedex",
            method: "GET",
            data: {
                api_key:"pokemon_charizard170305",
                page:page
            },
            success: function(respuesta){
                console.log(respuesta)
                currentPage = respuesta.pagination.current_page;
                
                //mostrar los pokemones en el grid
                mostrarPokemones(respuesta.pokemones);
                //actualizar los botones
                actualizarBotones(respuesta.pagination);
            },
            error: function(){
                alert("Hubo un error al cargar los pokemones");
            }
        })
        }
        function mostrarPokemones(pokemones){
            //limpiamos el grid
            $("#menu_tarjetas").empty();
            //creamos una plantilla para cada tarjeta 
            pokemones.forEach(function(pokemon){
                let tarjeta = `
                    <div class="flex-col border-4 border-white bg-white rounded-lg place-items-center">
                        <img src="${pokemon.foto}" class="w-32 h-auto" alt="${pokemon.nombre}">
                        <div class="bg-white shadow-xl rounded-lg p-2 m-2">
                            <p><strong>ID:</strong> ${pokemon.id}</p>
                            <p><strong>Name:</strong> ${pokemon.nombre}</p>
                            <p><strong>Type:</strong> ${pokemon.tipoo}</p>
                            
                        </div>
                    </div>
                `;
                $("#menu_tarjetas").append(tarjeta);
            });
        }

        //funcion para actualizar botones cuando llegan al limite
        function actualizarBotones(pagination){
            //si no hay pagina anterior tons bloqueado
            if (!pagination.has_previous) {
                $("#boton_iz").prop('disabled', true);
                $("#boton_iz").addClass('opacity-50 cursor-not-allowed');
            } else {
                $("#boton_iz").prop('disabled', false);
                $("#boton_iz").removeClass('opacity-50 cursor-not-allowed');
            }
            // Si no hay página siguiente, deshabilitar botón "adelante"
            if (!pagination.has_next) {
                $("#boton_der").prop('disabled', true);
                $("#boton_der").addClass('opacity-50 cursor-not-allowed');
            } else {
                $("#boton_der").prop('disabled', false);
                $("#boton_der").removeClass('opacity-50 cursor-not-allowed');
            }
        }
        $(document).ready(function(){
            cargarPokemones(1);
        });
    </script>
</body>
</html>